<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mon.aichat.mapper.AccountMapper">

    <!-- 配置 查询结果的列明和实体类的属性名的对应关系; -->
    <resultMap id="accountMap" type="com.mon.aichat.model.entity.AccountEntity">
        <!--主键字段的对应 -->
        <id property="id" javaType="Integer" column="id"/>
        <!--非主键字段的对应-->
        <result property="uid" javaType="String" column="uid"/>
        <result property="pwd" javaType="String" column="pwd"/>
        <result property="phone" javaType="String" column="phone"/>
        <result property="nickname" javaType="String" column="nickname"/>
        <result property="birthday" javaType="String" column="birthday"/>
        <result property="icon" javaType="String" column="icon"/>
        <result property="sign" javaType="String" column="sign"/>
        <result property="email" javaType="String" column="email"/>
        <result property="sex" javaType="Integer" column="sex"/>
        <!--        <result property="city" javaType="Integer" column="city"/>-->
        <result property="level" javaType="Integer" column="level"/>
        <result property="score" javaType="Integer" column="score"/>
        <result property="status" javaType="Integer" column="status"/>
        <result property="channel" javaType="Integer" column="channel"/>
        <result property="createTime" javaType="Date" column="create_time"/>
    </resultMap>

    <select id="login" resultMap="accountMap">
        SELECT * FROM account
        <where>
            <if test="body.phone!=null and body.phone!=''">
                phone=#{body.phone};
            </if>
            <if test="body.uid!=null and body.uid!=''">
                or uid=#{body.uid};
            </if>
            <if test="body.email!=null and body.email!=''">
                or email=#{body.email};
            </if>
            <if test="body.sign!=null and body.sign!=''">
                or sign=#{body.sign};
            </if>
        </where>
    </select>

    <select id="query" resultType="int">
        SELECT id FROM account where
        <if test="body.phone!=null and body.phone!=''">
            phone = #{body.phone};
        </if>
        <if test="body.email!=null and body.email!=''">
            email = #{body.email};
        </if>
    </select>

    <select id="queryById" resultMap="accountMap">
        SELECT * FROM account where id=#{id};
    </select>

    <select id="queryByUid" resultMap="accountMap">
        SELECT * FROM account where uid=#{uid};
    </select>

    <select id="queryByPhone" resultMap="accountMap">
        SELECT * FROM account where phone=#{phone};
    </select>

    <insert id="register" parameterType="com.mon.aichat.model.body.AccountBody" useGeneratedKeys="true"
            keyProperty="id">
        insert into account (uid,pwd,sign,phone,email,icon,nickname,create_time) values
        (#{user.uid},#{user.pwd},#{user.sign},#{user.phone},#{user.email},#{user.icon},#{user.nickname},#{user.createTime});
        <selectKey keyProperty="id" resultType="int" order="AFTER">
            SELECT LAST_INSERT_ID();
        </selectKey>
    </insert>

    <update id="updateAccount">
        update account
        <set>
            <if test="body.pwd!=null">
                pwd = #{body.pwd},
            </if>
            <if test="body.nickname!=null">
                nickname = #{body.nickname},
            </if>
        </set>
        where id = #{body.id};
    </update>

    <select id="reset" resultType="int">
        SELECT count(*) FROM account;
    </select>

    <select id="logout" resultType="int">
        SELECT count(*) FROM account;
    </select>

    <select id="total" resultType="int">
        SELECT count(*) FROM account;
    </select>

    <select id="lastId" resultType="int">
        SELECT id FROM account ORDER BY id DESC LIMIT 1;
    </select>

</mapper>